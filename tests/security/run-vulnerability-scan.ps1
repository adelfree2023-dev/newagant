# Automated Vulnerability Scanner
# ŸÅÿ≠ÿµ ÿßŸÑÿ´ÿ∫ÿ±ÿßÿ™ ÿßŸÑÿ™ŸÑŸÇÿßÿ¶Ÿä

$ErrorActionPreference = "Continue"

Write-Host "`nüêõ STARTING VULNERABILITY SCAN (npm audit)...`n" -ForegroundColor Yellow

$services = @("api", "storefront", "admin")
$basePath = "C:\Users\adelfree2023\Desktop\New folder"

foreach ($service in $services) {
    Write-Host "Scanning $service..." -ForegroundColor Cyan
    $servicePath = Join-Path $basePath $service
    
    if (Test-Path $servicePath) {
        Push-Location $servicePath
        try {
            # Run audit and capture output
            # We use --audit-level=high to focus on important issues
            $audit = npm audit --audit-level=high --json 2>&1 | Out-String | ConvertFrom-Json
            
            if ($audit.metadata.vulnerabilities.critical -gt 0 -or $audit.metadata.vulnerabilities.high -gt 0) {
                Write-Host "‚ùå [FAIL] $service has vulnerabilities!" -ForegroundColor Red
                Write-Host "   High: $($audit.metadata.vulnerabilities.high)" -ForegroundColor Red
                Write-Host "   Critical: $($audit.metadata.vulnerabilities.critical)" -ForegroundColor Red
            } else {
                Write-Host "‚úÖ [PASS] $service is clean (No High/Critical found)." -ForegroundColor Green
            }
        } catch {
            Write-Host "‚ö†Ô∏è [WARN] Could not run audit on $service (maybe no package-lock.json?)" -ForegroundColor Yellow
        }
        Pop-Location
    } else {
        Write-Host "‚ö†Ô∏è [WARN] Service directory not found: $service" -ForegroundColor Yellow
    }
}

Write-Host "`nüêõ SCAN COMPLETE." -ForegroundColor Yellow
